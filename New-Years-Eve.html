<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>New Year's Eve — Midnight Celebration</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#020317; --bg2:#08122a; --glass:rgba(255,255,255,0.04);
  --accent:#ffd07a; --accent-2:#9be7ff; --muted:#9fb1c4;
  --card-radius:18px; --focus: 3px solid rgba(155,200,255,0.12);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Montserrat,system-ui,Arial;background:
  radial-gradient(1200px 600px at 10% 10%, rgba(155,231,255,0.03), transparent 12%),
  linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 60%);color:#f6fbfc;-webkit-font-smoothing:antialiased}
.wrap{max-width:1100px;margin:28px auto;padding:20px}
.sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}
.header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:12px}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:62px;height:62px;border-radius:14px;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,var(--accent),#ff9db3);box-shadow:0 8px 30px rgba(255,160,120,0.08);
  font-family:'Playfair Display',serif;font-size:20px;color:#081022;font-weight:700}
.title h1{margin:0;font-family:'Playfair Display',serif;font-size:1.9rem;letter-spacing:0.6px}
.title .tag{color:var(--muted);font-weight:600;font-size:.95rem;margin-top:2px}

/* card */
.card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:var(--card-radius);padding:20px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 30px 80px rgba(2,6,23,0.6);position:relative;overflow:hidden;backdrop-filter: blur(6px)}
.grid{display:grid;grid-template-columns:320px 1fr;gap:22px;align-items:start}
@media (max-width:820px){ .grid{grid-template-columns:1fr;} .logo{width:52px;height:52px} }

/* poster */
.poster{border-radius:12px;overflow:hidden;height:100%;background:radial-gradient(circle at 20% 10%, rgba(255,215,122,0.08), transparent 10%),linear-gradient(180deg,#09121a,#071425);border:1px solid rgba(255,255,255,0.03);padding:18px;display:flex;flex-direction:column;gap:14px;justify-content:center}
.poster-visual{border-radius:10px;overflow:hidden;height:200px;background:linear-gradient(180deg,#081424,#0b2236);display:flex;align-items:center;justify-content:center}
.poster-visual img{width:100%;height:100%;object-fit:cover;display:block}
.badge{display:inline-block;padding:8px 12px;border-radius:999px;background:linear-gradient(90deg,var(--accent-2),#6ce0ff);color:#041428;font-weight:700;font-size:.9rem}

/* meta */
.meta{padding:6px 2px}
.pill{background:rgba(255,255,255,0.02);padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);font-weight:700;color:#f3fbfd}
.synopsis{color:#dbeff6;line-height:1.55}
.controls{display:flex;gap:12px;align-items:center;margin-top:14px;flex-wrap:wrap}
.btn{background:linear-gradient(90deg,var(--accent-2),#bde9ff);color:#041428;border:none;padding:10px 16px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 12px 30px rgba(11,146,176,0.06);transition:transform .12s ease,box-shadow .14s ease}
.btn:hover{transform:translateY(-2px)}
.btn.secondary{background:transparent;color:#f6fbfc;border:1px solid rgba(255,255,255,0.06);box-shadow:none;font-weight:700}
.countdown{margin-left:6px;color:var(--accent-2);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);font-weight:700}

/* RSVP form */
.rsvp-form{display:none;margin-top:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);max-width:560px}
.rsvp-form label{display:block;color:#eef7fb;margin-bottom:8px;font-weight:600}
.rsvp-form input, .rsvp-form textarea, .rsvp-form select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#f7fcff;margin-top:6px}
.form-row{display:flex;gap:8px}
.form-row > *{flex:1}

/* QR / ticket */
.qr-wrap{display:none;margin-top:12px}
.qr-wrap img{width:128px;height:128px;border-radius:12px;background:#fff;padding:8px}

/* details & procedure */
.details{margin-top:18px;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03)}
.details h2{font-family:'Playfair Display',serif;margin:0;color:var(--accent)}
.details p, .details li{color:#d6eef8}

/* footer */
.footer{margin-top:18px;color:var(--muted);display:flex;justify-content:space-between;flex-wrap:wrap;gap:12px}

/* mobile menu */
.mobile-menu-btn{display:none}
.mobile-menu{position:fixed;right:18px;bottom:18px;background:linear-gradient(180deg,#04202c,#081a28);border-radius:14px;padding:12px;box-shadow:0 28px 70px rgba(2,6,23,0.6);display:none;z-index:120}
.mobile-menu.open{display:block}
.mobile-menu button{display:block;background:transparent;border:0;color:#e9fbff;padding:8px 10px;text-align:left;width:220px;border-radius:10px}

/* fireworks decoration */
.fireworks{position:absolute;right:-10%;top:-10%;width:140%;height:140%;pointer-events:none;mix-blend-mode:screen;opacity:0.6}

/* focus */
[tabindex]:focus,button:focus,input:focus,select:focus{outline:none;box-shadow:var(--focus);border-radius:10px}

/* responsive */
@media (max-width:820px){
  .header{flex-direction:column;align-items:flex-start}
  .grid{grid-template-columns:1fr;gap:16px}
  .poster-visual{height:160px}
  .mobile-menu-btn{display:inline-flex}
  .mobile-menu{right:12px;bottom:12px}
}
</style>
</head>
<body>
<a class="sr-only" href="#mainArea">Skip to content</a>

<div class="wrap">
  <header class="header" role="banner">
    <div class="brand" aria-hidden="false">
      <div class="logo" aria-hidden="true">NYE</div>
      <button id="backBtn" class="btn secondary" aria-label="Go back" style="margin-left:6px">← Back</button>
      <div class="title" style="margin-left:6px">
        <h1>New Year's Eve</h1>
        <div class="tag">Midnight Celebration • Live music • Fireworks</div>
      </div>
    </div>

    <div>
      <button id="menuToggle" class="btn secondary" aria-controls="details" aria-expanded="false">Show details</button>
      <button id="mobileMenuBtn" class="mobile-menu-btn" aria-haspopup="dialog" aria-expanded="false" aria-controls="mobileMenu" style="margin-left:8px">☰</button>
    </div>
  </header>

  <section id="mainArea" class="card" role="main" aria-labelledby="pageTitle">
    <div class="fireworks" aria-hidden="true">
      <svg viewBox="0 0 800 600" preserveAspectRatio="none" width="100%" height="100%">
        <defs>
          <radialGradient id="g1"><stop offset="0" stop-color="#ffd07a" stop-opacity="0.6"/><stop offset="1" stop-color="#ff9db3" stop-opacity="0"/></radialGradient>
        </defs>
        <circle cx="120" cy="80" r="6" fill="url(#g1)">
          <animate attributeName="r" values="2;40" dur="2.8s" repeatCount="indefinite" begin="0s"/>
          <animate attributeName="opacity" values="1;0" dur="2.8s" repeatCount="indefinite" begin="0s"/>
        </circle>
        <circle cx="540" cy="160" r="4" fill="#9be7ff">
          <animate attributeName="r" values="2;48" dur="3.2s" repeatCount="indefinite" begin="0.6s"/>
          <animate attributeName="opacity" values="1;0" dur="3.2s" repeatCount="indefinite" begin="0.6s"/>
        </circle>
      </svg>
    </div>

    <div class="grid" aria-describedby="synopsis">
      <aside class="poster" aria-label="Event spotlight">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <span class="badge">Free • All Ages</span>
          <div style="color:var(--muted);font-weight:700">Dec 31 • 11:00 PM</div>
        </div>

        <div class="poster-visual" aria-hidden="true">
          <img src="https://thumbs.dreamstime.com/b/crowd-watching-fireworks-celebrating-new-year-crowd-watching-fireworks-celebrating-new-year-eve-131970378.jpg" alt="Fireworks over the harbor (replace assets/newyear.jpg)">
        </div>

        <div style="font-size:.95rem;color:#eaf7ff;margin-top:10px">
          Harbor Park — Main Stage. Live bands, food trucks and family-friendly viewing. Fireworks at midnight.
        </div>

        <div style="margin-top:14px;display:flex;gap:8px">
          <button id="rsvpBtn" class="btn" aria-label="Open RSVP form">RSVP</button>
          <button id="shareBtn" class="btn secondary" aria-label="Share event">Share</button>
        </div>

        <div class="qr-wrap" id="qrWrap" aria-hidden="true" style="margin-top:14px">
          <img id="qrImg" alt="Ticket QR code" src="">
          <div style="margin-top:8px">
            <button id="downloadQr" class="btn secondary">Download QR</button>
          </div>
        </div>
      </aside>

      <div class="meta">
        <div id="synopsis" class="synopsis">
          Ring in the new year among friends and family with live music, local eats and a spectacular midnight fireworks display over the harbor. Accessible viewing and staff on site for safety and assistance.
        </div>

        <div class="controls" role="region" aria-label="Event controls" style="margin-top:12px">
          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
            <div id="countdown" class="countdown" data-date="2025-12-31T23:59:59" aria-live="polite">Loading…</div>
            <button id="detailsToggle" class="btn secondary" aria-controls="details" aria-expanded="false">More details</button>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button id="downloadTicket" class="btn secondary" style="display:none">Download ticket</button>
            </div>
          </div>
        </div>

        <form id="rsvpForm" class="rsvp-form" aria-hidden="true" aria-labelledby="rsvpHeading">
          <div id="rsvpHeading" class="sr-only">RSVP for New Year's Eve</div>
          <label>Full name<input name="name" type="text" required aria-required="true" placeholder="Your name"></label>
          <label>Email <input name="email" type="email" placeholder="you@example.com"></label>
          <div class="form-row">
            <label>Guests <input name="guests" type="number" min="0" value="0"></label>
            <label>Zone <select name="zone"><option>General</option><option>Accessible</option><option>Family</option></select></label>
          </div>
          <label>Notes <textarea name="notes" rows="3" placeholder="Accessibility needs or meeting notes"></textarea></label>

          <div style="display:flex;gap:10px;margin-top:8px">
            <button type="submit" class="btn">Confirm RSVP</button>
            <button type="button" id="cancelRSVP" class="btn secondary">Cancel</button>
          </div>
          <div id="rsvpSuccess" role="status" aria-live="polite" style="margin-top:10px;color:#bdf3ff;font-weight:700"></div>
        </form>

        <section id="details" class="details" aria-hidden="false" style="margin-top:18px">
          <h2>Event details & accessibility</h2>
          <p>Food trucks, warm beverage stands and accessible viewing areas. Please keep pathways clear for emergency access. Service animals welcome.</p>
          <ul>
            <li>Fireworks at midnight; viewing begins at 11:45pm</li>
            <li>Accessible drop-off & seating zones</li>
            <li>Follow staff instructions for safety zones and barriers</li>
          </ul>

          <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">

          <div aria-labelledby="procedureHeading">
            <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
              <h3 id="procedureHeading" style="margin:0;color:var(--accent)">Procedure — What to expect</h3>
              <div style="display:flex;gap:8px">
                <button id="procToggle" class="btn secondary" aria-expanded="false" aria-controls="procedureContent">Show procedure</button>
                <button id="downloadProcedure" class="btn secondary" aria-label="Download procedure">Download procedure</button>
              </div>
            </div>

            <div id="procedureContent" style="margin-top:12px;display:none" aria-hidden="true">
              <ol style="color:#d6eef8;line-height:1.6">
                <li><strong>Arrival</strong> — Plan to arrive 30–45 minutes before start to find parking or transit drop-off and choose a viewing spot.</li>
                <li><strong>Entry & safety check</strong> — Staff may perform brief bag checks. Please cooperate with staff and volunteers.</li>
                <li><strong>Seating & zones</strong> — Zones: General, Family, Accessible. If you need accessible seating ask staff for direction.</li>
                <li><strong>Facilities</strong> — Food trucks, restrooms and first-aid are near the main concourse. Look for signage or ask volunteers.</li>
                <li><strong>Fireworks & countdown</strong> — Midnight fireworks begin at 00:00. Stay behind barriers for safety.</li>
                <li><strong>Leaving & transit</strong> — Follow staff directions for orderly exit. Public transit recommended to reduce congestion.</li>
                <li><strong>Lost & found / help</strong> — Visit the Information tent or contact event staff. In emergencies, follow announcements and staff guidance.</li>
                <li><strong>Weather & clothing</strong> — Dress warmly; the event proceeds in cold weather unless otherwise announced.</li>
              </ol>
              <p style="color:#d6eef8;margin-top:10px"><strong>Accessibility & support:</strong> Service animals welcome. Email events@city.local for assistance or speak with staff at the Accessible zone.</p>
            </div>
          </div>
        </section>
      </div>
    </div>

    <footer class="footer" aria-label="Event footer">
      <div>Location: <strong style="color:var(--accent-2)">Harbor Park</strong></div>
      <div style="color:var(--muted)">&copy; <span id="yearNYE"></span> City Events</div>
    </footer>
  </section>
</div>

<!-- Mobile menu dialog -->
<nav id="mobileMenu" class="mobile-menu" aria-hidden="true" role="dialog" aria-label="Mobile menu">
  <button id="mobileDetailsBtn">Toggle details</button>
  <button id="mobileRsvpBtn">Open RSVP</button>
  <button id="mobileDownloadQrBtn">Download QR</button>
  <button id="mobileCloseBtn" aria-label="Close menu">Close</button>
</nav>

<script>
/* countdown */
(function(){
  const el = document.getElementById('countdown');
  if(!el) return;
  function update(){
    const date = new Date(el.dataset.date);
    const diff = date - new Date();
    if(diff <= 0){ el.textContent = "Happy New Year!"; return; }
    const d = Math.floor(diff/86400000), h = Math.floor((diff/3600000)%24);
    const m = Math.floor((diff/60000)%60), s = Math.floor((diff/1000)%60);
    el.textContent = `Starts in ${d}d ${h}h ${m}m ${s}s`;
  }
  update(); setInterval(update,1000);
})();

/* details toggles */
(function(){
  const det = document.getElementById('details');
  const headerBtn = document.getElementById('menuToggle');
  const detailsBtn = document.getElementById('detailsToggle');
  [headerBtn, detailsBtn].forEach(btn=>{
    if(!btn) return;
    btn.addEventListener('click', ()=>{
      const hidden = det.classList.toggle('hidden');
      det.setAttribute('aria-hidden', hidden ? 'true' : 'false');
      btn.setAttribute('aria-expanded', !hidden);
      btn.textContent = hidden ? 'Show details' : 'Hide details';
      if(!hidden) det.querySelector('h2')?.focus();
    });
  });
})();

/* procedure toggle + download */
(function(){
  const toggle = document.getElementById('procToggle');
  const content = document.getElementById('procedureContent');
  const dl = document.getElementById('downloadProcedure');
  if(toggle && content){
    toggle.addEventListener('click', ()=>{
      const open = content.style.display !== 'block';
      content.style.display = open ? 'block' : 'none';
      content.setAttribute('aria-hidden', open ? 'false' : 'true');
      toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      toggle.textContent = open ? 'Hide procedure' : 'Show procedure';
    });
  }
  if(dl && content){
    dl.addEventListener('click', ()=>{
      const lines = [];
      const ol = content.querySelector('ol');
      if(ol) Array.from(ol.children).forEach((li,i)=> lines.push((i+1)+'. '+li.innerText.trim()));
      const extras = Array.from(content.querySelectorAll('p')).map(p=>p.innerText.trim());
      const text = ['Procedure — What to expect','',...lines,'',...extras].join('\n\n');
      const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'nye-procedure.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });
  }
})();

/* mobile menu with focus management */
(function(){
  const menuBtn = document.getElementById('mobileMenuBtn');
  const menu = document.getElementById('mobileMenu');
  const close = document.getElementById('mobileCloseBtn');
  const mobileDetailsBtn = document.getElementById('mobileDetailsBtn');
  const mobileRsvpBtn = document.getElementById('mobileRsvpBtn');
  const mobileDownloadQrBtn = document.getElementById('mobileDownloadQrBtn');
  const details = document.getElementById('details');
  const rsvpBtn = document.getElementById('rsvpBtn');
  const downloadQr = document.getElementById('downloadQr');
  if(!menuBtn || !menu) return;
  let lastFocus = null;
  function open(){ lastFocus = document.activeElement; menu.classList.add('open'); menu.setAttribute('aria-hidden','false'); menuBtn.setAttribute('aria-expanded','true'); close.focus(); document.body.style.overflow='hidden'; }
  function closeMenu(){ menu.classList.remove('open'); menu.setAttribute('aria-hidden','true'); menuBtn.setAttribute('aria-expanded','false'); document.body.style.overflow=''; if(lastFocus) lastFocus.focus(); }
  menuBtn.addEventListener('click', ()=> menu.classList.contains('open') ? closeMenu() : open());
  close?.addEventListener('click', closeMenu);
  mobileDetailsBtn?.addEventListener('click', ()=>{ details.classList.toggle('hidden'); details.setAttribute('aria-hidden', details.classList.contains('hidden')); closeMenu(); });
  mobileRsvpBtn?.addEventListener('click', ()=>{ rsvpBtn.click(); closeMenu(); });
  mobileDownloadQrBtn?.addEventListener('click', ()=>{ if(downloadQr) downloadQr.click(); else alert('QR not available'); closeMenu(); });
  document.addEventListener('keydown', e=>{ if(e.key==='Escape' && menu.classList.contains('open')) closeMenu(); });
})();

/* RSVP + QR + ticket logic */
(function(){
  const EVENT_KEY = "New Year's Eve";
  const STORAGE_KEY = 'nye_rsvps';
  const rsvpBtn = document.getElementById('rsvpBtn');
  const rsvpForm = document.getElementById('rsvpForm');
  const cancel = document.getElementById('cancelRSVP');
  const success = document.getElementById('rsvpSuccess');
  const qrWrap = document.getElementById('qrWrap');
  const qrImg = document.getElementById('qrImg');
  const downloadQr = document.getElementById('downloadQr');
  const downloadTicket = document.getElementById('downloadTicket');
  const controls = document.querySelector('.controls') || document.getElementById('controls');
  const card = document.querySelector('.card');

  const EVENT_INFO = {
    venue: 'Harbor Park',
    address: '1 Harbor Way, Yourtown',
    contact: 'events@city.local',
    instructions: 'Fireworks at midnight. Stay within viewing zones and follow staff instructions.'
  };

  function store(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}'); }catch{return {}; } }
  function save(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }
  function makeId(){ return 'NYE-'+Date.now().toString(36).slice(-8).toUpperCase(); }
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  function buildTicket(entry){
    const now = new Date().toLocaleString();
    return `<!doctype html><html><head><meta charset="utf-8"><title>Ticket</title></head><body><h2>New Year's Eve Ticket</h2><div><strong>Ticket ID:</strong> ${escapeHtml(entry.id)}</div><div><strong>Name:</strong> ${escapeHtml(entry.name)}</div><div><strong>Guests:</strong> ${escapeHtml(entry.guests)}</div><div><strong>Notes:</strong> ${escapeHtml(entry.notes||'')}</div><div><strong>Venue:</strong> ${escapeHtml(EVENT_INFO.venue)}</div><div style="margin-top:8px;color:#666;font-size:.9rem">Generated: ${escapeHtml(now)}</div></body></html>`;
  }

  let lastQrUrl = '';
  function generateQRData(entry){
    const payload = {
      event: EVENT_KEY,
      ticketId: entry.id || makeId(),
      name: entry.name,
      email: entry.email || '',
      guests: Number(entry.guests || 0),
      notes: entry.notes || '',
      time: entry.time || new Date().toISOString(),
      venue: EVENT_INFO.venue,
      address: EVENT_INFO.address,
      contact: EVENT_INFO.contact,
      instructions: EVENT_INFO.instructions,
      maps: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(EVENT_INFO.address)}`
    };
    if(!entry.id){
      const s = store(); s[EVENT_KEY] = Object.assign({}, entry, { id: payload.ticketId }); save(s); entry.id = payload.ticketId;
    }
    lastQrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=' + encodeURIComponent(JSON.stringify(payload));
    qrImg.src = lastQrUrl;
    if(qrWrap){ qrWrap.style.display = 'block'; qrWrap.setAttribute('aria-hidden','false'); }
  }

  function render(){
    const s = store();
    const has = !!s[EVENT_KEY];
    if(has){
      rsvpBtn.style.display = 'none';
      downloadTicket.style.display = 'inline-block';
      card.classList.add('rsvped');
      if(controls && !controls.querySelector('.remove-btn')){
        const rem = document.createElement('button'); rem.className = 'remove-btn btn secondary'; rem.textContent = 'Remove RSVP';
        rem.addEventListener('click', function(){ if(!confirm('Remove your RSVP?')) return; const st = store(); delete st[EVENT_KEY]; save(st); render(); alert('Your RSVP was removed.'); });
        if(controls.firstElementChild) controls.firstElementChild.insertAdjacentElement('afterend', rem); else controls.appendChild(rem);
      }
      const entry = s[EVENT_KEY]; if(entry) generateQRData(entry);
      success.textContent = 'You are RSVP’d — ticket generated.';
    } else {
      rsvpBtn.style.display = 'inline-block';
      downloadTicket.style.display = 'none';
      card.classList.remove('rsvped');
      const rem = controls && controls.querySelector('.remove-btn'); if(rem) rem.remove();
      if(qrWrap){ qrWrap.style.display = 'none'; qrWrap.setAttribute('aria-hidden','true'); }
      lastQrUrl = '';
      success.textContent = '';
    }
    if(rsvpForm){ rsvpForm.style.display = 'none'; rsvpForm.setAttribute('aria-hidden','true'); }
  }

  rsvpBtn.addEventListener('click', ()=>{ rsvpForm.style.display='block'; rsvpForm.setAttribute('aria-hidden','false'); rsvpForm.querySelector('input[name="name"]')?.focus(); });
  cancel.addEventListener('click', ()=>{ rsvpForm.style.display='none'; rsvpForm.setAttribute('aria-hidden','true'); rsvpBtn.focus(); });

  rsvpForm.addEventListener('submit', function(e){
    e.preventDefault();
    const name = this.querySelector('input[name="name"]').value.trim();
    const email = this.querySelector('input[name="email"]').value.trim();
    const guests = Number(this.querySelector('input[name="guests"]').value || 0);
    const notes = this.querySelector('textarea[name="notes"]').value.trim();
    if(!name){ alert('Please enter your name'); this.querySelector('input[name="name"]').focus(); return; }
    const entry = { id: makeId(), name, email, guests, notes, time: new Date().toISOString() };
    const s = store(); s[EVENT_KEY] = entry; save(s);
    success.textContent = 'RSVP saved';
    setTimeout(()=>{ render(); alert('Thanks — your RSVP recorded.'); }, 300);
  });

  downloadQr?.addEventListener('click', async function(){
    const url = lastQrUrl || window._lastQr;
    if(!url){ alert('QR not ready'); return; }
    try{
      const r = await fetch(url); if(!r.ok) throw new Error('fetch failed');
      const b = await r.blob(); const u = URL.createObjectURL(b);
      const a = document.createElement('a'); a.href = u; const s = store(); const e = s[EVENT_KEY]||{id:'ticket'}; a.download = `nye-qr-${(e.id||'ticket')}.png`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(u);
    }catch(err){ alert('Download failed'); console.warn(err); }
  });

  downloadTicket?.addEventListener('click', function(){
    const s = store(); const e = s[EVENT_KEY]; if(!e){ alert('No RSVP'); return; }
    const html = buildTicket(e); const blob = new Blob([html], { type: 'text/html' }); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = `nye-ticket-${(e.id||e.name).replace(/\s+/g,'_')}.html`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  document.getElementById('shareBtn')?.addEventListener('click', async function(){
    const shareData = { title: "New Year's Eve at Harbor Park", text: "Join us for live music & fireworks at midnight!", url: location.href };
    try{ if(navigator.share) await navigator.share(shareData); else prompt('Copy link', location.href); }catch(e){ console.warn(e); }
  });

  render();
})();

/* footer year */
document.getElementById('yearNYE').textContent = new Date().getFullYear();

/* back button */
(function(){
  const back = document.getElementById('backBtn');
  if(!back) return;
  back.addEventListener('click', function(){
    if(window.history.length > 1) window.history.back();
    else window.location.href = '/';
  });
  back.addEventListener('keydown', function(e){
    if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); back.click(); }
  });
})();
</script>
</body>
</html>